# 待办事项应用技术架构文档

## 1. 项目概述

### 1.1 项目目标
构建一个功能完整的待办事项管理应用，支持任务的增删改查、状态管理和分类查看等核心功能。

### 1.2 核心功能
- 添加待办事项
- 标记任务完成/未完成
- 删除待办事项
- 按状态筛选任务（全部、未完成、已完成）
- 批量清除功能（清除已完成、清除全部）

## 2. 技术选型

### 2.1 前端技术栈
- **框架**: React 18+ (TypeScript)
- **样式**: CSS3 + CSS Modules
- **状态管理**: React Hooks (useState, useEffect)
- **HTTP客户端**: Axios
- **构建工具**: Create React App 或 Vite

### 2.2 后端技术栈
- **框架**: FastAPI
- **数据库**: SQLite3
- **ORM**: SQLAlchemy
- **异步支持**: asyncio, aiofiles
- **API文档**: 自动生成Swagger UI

### 2.3 开发工具
- **版本控制**: Git
- **API测试**: FastAPI自动生成的Swagger UI
- **代码格式化**: Prettier (前端) + Black (后端)

## 3. 项目结构

```
项目根目录/
├── backend/                    # 后端代码
│   ├── app/
│   │   ├── __init__.py
│   │   ├── main.py            # FastAPI应用入口
│   │   ├── database.py        # 数据库连接配置
│   │   ├── models.py          # 数据模型
│   │   ├── schemas.py         # Pydantic数据验证模式
│   │   └── routers/
│   │       └── todos.py       # 待办事项相关API路由
│   ├── requirements.txt       # Python依赖包
│   └── todos.db              # SQLite数据库文件
└── frontend/                  # 前端代码
    ├── public/
    │   └── index.html
    ├── src/
    │   ├── components/
    │   │   ├── TodoForm.tsx   # 添加待办事项表单
    │   │   ├── TodoItem.tsx   # 单个待办事项组件
    │   │   ├── TodoList.tsx   # 待办事项列表
    │   │   └── FilterBar.tsx  # 筛选和操作栏
    │   ├── services/
    │   │   └── api.ts         # API调用服务
    │   ├── types/
    │   │   └── todo.ts        # TypeScript类型定义
    │   ├── styles/
    │   │   └── globals.css    # 全局样式
    │   ├── App.tsx
    │   └── index.tsx
    ├── package.json
    └── tsconfig.json
```

## 4. 数据库设计

### 4.1 数据表结构

#### todos 表
```sql
CREATE TABLE todos (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    completed BOOLEAN DEFAULT FALSE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### 4.2 数据表字段说明

| 字段名 | 数据类型 | 说明 | 约束 |
|--------|----------|------|------|
| id | INTEGER | 主键，自动递增 | PRIMARY KEY |
| title | VARCHAR(255) | 待办事项标题 | NOT NULL |
| description | TEXT | 待办事项详细描述 | 可选 |
| completed | BOOLEAN | 完成状态 | DEFAULT FALSE |
| created_at | DATETIME | 创建时间 | DEFAULT CURRENT_TIMESTAMP |
| updated_at | DATETIME | 更新时间 | DEFAULT CURRENT_TIMESTAMP |

### 4.3 初始化SQL语句

```sql
-- 创建数据库表
CREATE TABLE IF NOT EXISTS todos (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    completed BOOLEAN DEFAULT FALSE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 创建索引优化查询性能
CREATE INDEX idx_todos_completed ON todos(completed);
CREATE INDEX idx_todos_created_at ON todos(created_at);

-- 插入示例数据
INSERT INTO todos (title, description, completed) VALUES 
('学习React', '完成React基础教程', FALSE),
('完成项目文档', '编写技术架构文档', FALSE),
('代码审查', '审查待办事项应用代码', TRUE);
```

## 5. API接口设计

### 5.1 基础信息
- **Base URL**: `http://localhost:8000/api/v1`
- **Content-Type**: `application/json`
- **响应格式**: JSON

### 5.2 响应状态码

| 状态码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 201 | 创建成功 |
| 400 | 请求参数错误 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

### 5.3 API接口列表

#### 5.3.1 获取所有待办事项
```
GET /api/v1/todos
```

**查询参数:**
- `completed`: 可选，筛选条件 (`true`/`false`/不传表示全部)

**响应示例:**
```json
{
    "code": 200,
    "message": "success",
    "data": [
        {
            "id": 1,
            "title": "学习React",
            "description": "完成React基础教程",
            "completed": false,
            "created_at": "2024-01-01T10:00:00",
            "updated_at": "2024-01-01T10:00:00"
        }
    ]
}
```

#### 5.3.2 创建待办事项
```
POST /api/v1/todos
```

**请求体:**
```json
{
    "title": "待办事项标题",
    "description": "详细描述（可选）"
}
```

**响应示例:**
```json
{
    "code": 201,
    "message": "Todo created successfully",
    "data": {
        "id": 2,
        "title": "待办事项标题",
        "description": "详细描述（可选）",
        "completed": false,
        "created_at": "2024-01-01T10:30:00",
        "updated_at": "2024-01-01T10:30:00"
    }
}
```

#### 5.3.3 更新待办事项
```
PUT /api/v1/todos/{todo_id}
```

**请求体:**
```json
{
    "title": "更新后的标题",
    "description": "更新后的描述",
    "completed": true
}
```

**响应示例:**
```json
{
    "code": 200,
    "message": "Todo updated successfully",
    "data": {
        "id": 1,
        "title": "更新后的标题",
        "description": "更新后的描述",
        "completed": true,
        "created_at": "2024-01-01T10:00:00",
        "updated_at": "2024-01-01T11:00:00"
    }
}
```

#### 5.3.4 删除待办事项
```
DELETE /api/v1/todos/{todo_id}
```

**响应示例:**
```json
{
    "code": 200,
    "message": "Todo deleted successfully"
}
```

#### 5.3.5 批量删除已完成的待办事项
```
DELETE /api/v1/todos/completed
```

**响应示例:**
```json
{
    "code": 200,
    "message": "Completed todos deleted successfully",
    "data": {
        "deleted_count": 3
    }
}
```

#### 5.3.6 删除所有待办事项
```
DELETE /api/v1/todos/all
```

**响应示例:**
```json
{
    "code": 200,
    "message": "All todos deleted successfully",
    "data": {
        "deleted_count": 10
    }
}
```

## 6. 前端架构设计

### 6.1 组件层次结构

```
App
├── TodoForm          # 添加待办事项表单
├── FilterBar          # 筛选条件和批量操作
└── TodoList           # 待办事项列表
    └── TodoItem       # 单个待办事项（多个）
```

### 6.2 状态管理

#### 6.2.1 全局状态
```typescript
interface AppState {
    todos: Todo[];
    filter: 'all' | 'active' | 'completed';
    loading: boolean;
    error: string | null;
}
```

#### 6.2.2 Todo数据模型
```typescript
interface Todo {
    id: number;
    title: string;
    description?: string;
    completed: boolean;
    created_at: string;
    updated_at: string;
}
```

### 6.3 核心功能实现

#### 6.3.1 数据获取
- 组件挂载时从API获取待办事项列表
- 实现加载状态和错误处理

#### 6.3.2 添加功能
- 表单验证（标题不能为空）
- 成功添加后清空输入框
- 实时更新列表

#### 6.3.3 更新功能
- 切换完成状态
- 支持编辑模式（点击编辑按钮）

#### 6.3.4 删除功能
- 单个删除确认
- 批量删除确认

#### 6.3.5 筛选功能
- 本地筛选逻辑
- URL状态同步

## 7. 后端架构设计

### 7.1 项目结构说明

#### 7.1.1 主要模块
- **main.py**: FastAPI应用入口，配置CORS和路由
- **database.py**: SQLAlchemy数据库配置和连接
- **models.py**: SQLAlchemy ORM模型定义
- **schemas.py**: Pydantic请求/响应数据验证
- **routers/todos.py**: 待办事项相关API路由处理

#### 7.1.2 数据验证模式

```python
# Pydantic Schemas
class TodoBase(BaseModel):
    title: str
    description: Optional[str] = None

class TodoCreate(TodoBase):
    pass

class TodoUpdate(BaseModel):
    title: Optional[str] = None
    description: Optional[str] = None
    completed: Optional[bool] = None

class TodoResponse(TodoBase):
    id: int
    completed: bool
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True
```

### 7.2 错误处理

#### 7.2.1 异常处理机制
- 自定义异常类
- 全局异常处理器
- 详细错误日志记录

#### 7.2.2 数据验证
- Pydantic自动验证请求数据
- 业务逻辑验证
- 数据库约束验证

## 8. 开发环境配置

### 8.1 后端环境配置

#### 8.1.1 Python环境
```bash
# 创建虚拟环境
python -m venv venv

# 激活虚拟环境 (Windows)
venv\Scripts\activate

# 激活虚拟环境 (macOS/Linux)
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt
```

#### 8.1.2 requirements.txt
```txt
fastapi==0.104.1
uvicorn==0.24.0
sqlalchemy==2.0.23
aiosqlite==0.19.0
pydantic==2.5.0
python-multipart==0.0.6
```

#### 8.1.3 启动后端服务
```bash
cd backend
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 8.2 前端环境配置

#### 8.2.1 Node.js环境
```bash
# 安装依赖
cd frontend
npm install

# 启动开发服务器
npm start
```

#### 8.2.2 package.json主要依赖
```json
{
    "dependencies": {
        "react": "^18.2.0",
        "react-dom": "^18.2.0",
        "axios": "^1.6.0",
        "typescript": "^4.9.5"
    },
    "devDependencies": {
        "@types/react": "^18.2.0",
        "@types/react-dom": "^18.2.0",
        "react-scripts": "5.0.1"
    }
}
```

## 9. 部署配置

### 9.1 生产环境配置

#### 9.1.1 后端部署
- 使用Gunicorn作为WSGI服务器
- 配置环境变量管理
- 数据库备份策略

#### 9.1.2 前端部署
- 构建生产版本：`npm run build`
- 使用Nginx提供静态文件服务
- 配置反向代理到后端API

### 9.2 Docker部署

#### 9.2.1 Dockerfile示例
```dockerfile
# 后端Dockerfile
FROM python:3.11-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
EXPOSE 8000
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

#### 9.2.2 docker-compose.yml
```yaml
version: '3.8'
services:
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    volumes:
      - ./backend/todos.db:/app/todos.db
  
  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    depends_on:
      - backend
```

## 10. 测试策略

### 10.1 后端测试
- 使用pytest进行单元测试
- API端点集成测试
- 数据库操作测试

### 10.2 前端测试
- 使用Jest + React Testing Library
- 组件单元测试
- 用户交互测试

## 11. 性能优化

### 11.1 前端优化
- React.memo避免不必要的重渲染
- useMemo缓存计算结果
- 懒加载大型组件

### 11.2 后端优化
- 数据库查询优化
- 响应数据分页
- 缓存常用查询结果

## 12. 安全考虑

### 12.1 前端安全
- 输入验证和XSS防护
- HTTPS通信
- 敏感数据处理

### 12.2 后端安全
- CORS配置
- 输入验证和SQL注入防护
- 错误信息安全处理

---

## 附录

### A. 开发时间线
- 第1-2天: 后端API开发和数据库设计
- 第3-4天: 前端组件开发和样式设计
- 第5天: 前后端集成和测试
- 第6天: 优化和部署配置

### B. 参考资料
- [FastAPI官方文档](https://fastapi.tiangolo.com/)
- [React官方文档](https://react.dev/)
- [SQLAlchemy文档](https://docs.sqlalchemy.org/)
- [TypeScript官方文档](https://www.typescriptlang.org/)
